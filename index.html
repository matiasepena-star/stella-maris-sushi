<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Sushi Stella Maris</title>

<style>
  :root{
    --bg:#0b0b0c;
    --panel:#101114;
    --card:#15161a;
    --line:#262830;
    --text:#f3f3f3;
    --muted:#b7b7b7;
    --gold:#caa76a;
    --gold2:#8f6f3f;
    --shadow: 0 18px 55px rgba(0,0,0,.55);
    --radius:18px;
  }

  *{box-sizing:border-box}
  body{
    margin:0;
    font-family:-apple-system,BlinkMacSystemFont,"SF Pro Text","Segoe UI",Roboto,Arial,sans-serif;
    background:
      radial-gradient(1200px 700px at 50% -10%, rgba(202,167,106,.18), transparent 55%),
      radial-gradient(900px 550px at 20% 20%, rgba(255,255,255,.06), transparent 52%),
      var(--bg);
    color:var(--text);
  }

  /* Header fijo */
  header{
    position:fixed; top:0; left:0; right:0;
    z-index:1000;
    background: rgba(15,16,18,.92);
    backdrop-filter: blur(12px);
    border-bottom:1px solid rgba(255,255,255,.08);
    padding:14px 14px 12px;
  }
  .wrap{max-width:720px; margin:0 auto;}
  .brandRow{display:flex; align-items:center; gap:12px;}
  .logo{
    width:40px; height:40px; border-radius:14px;
    display:grid; place-items:center;
    color:var(--gold);
    background:
      radial-gradient(circle at 30% 30%, rgba(255,255,255,.14), transparent 40%),
      linear-gradient(135deg, rgba(202,167,106,.28), rgba(202,167,106,.08));
    border:1px solid rgba(202,167,106,.25);
    user-select:none;
  }
  h1{margin:0; font-size:18px; letter-spacing:.2px; font-weight:950;}

  /* Tabs: 1 lÃ­nea con scroll suave */
  .tabs{
    margin-top:12px;
    display:flex;
    gap:10px;
    flex-wrap:nowrap;
    overflow:auto;
    -webkit-overflow-scrolling: touch;
    padding-bottom:2px;
  }
  .tabs::-webkit-scrollbar{height:0}
  .tab{
    flex:0 0 auto;
    text-align:center;
    padding:11px 12px;
    border-radius:14px;
    cursor:pointer;
    font-size:14px;
    font-weight:900;
    color: rgba(255,255,255,.90);
    background: rgba(255,255,255,.04);
    border:1px solid rgba(255,255,255,.10);
    user-select:none;
    transition: transform .08s ease, background .15s ease, border-color .15s ease, filter .15s ease;
    -webkit-tap-highlight-color: transparent;
    white-space:nowrap;
  }
  .tab:active{transform: translateY(1px) scale(.99); filter:brightness(.95);}
  .tab.active{
    background: rgba(202,167,106,.16);
    border-color: rgba(202,167,106,.40);
    color:#fff;
  }

  /* Contenido scroll */
  .content{
    max-width:720px;
    margin:0 auto;
    padding: 120px 14px 170px; /* header + footer */
  }

  .sectionTitle{
    margin: 10px 2px 10px;
    color: var(--gold);
    letter-spacing:.35em;
    font-weight:950;
    font-size: 12px;
    text-transform: uppercase;
  }

  /* 1 columna siempre */
  .grid{
    display:grid;
    gap:14px;
    grid-template-columns: 1fr;
  }

  .card{
    background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
    border:1px solid rgba(255,255,255,.08);
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    overflow:hidden;
    position:relative;
  }

  /* Imagen: sin estirar + se ve toda */
  .imgBox{
    height: 250px; /* piezas */
    background:
      radial-gradient(220px 140px at 20% 20%, rgba(202,167,106,.14), transparent 60%),
      radial-gradient(220px 140px at 80% 0%, rgba(255,255,255,.06), transparent 60%),
      rgba(0,0,0,.30);
    border-bottom:1px solid rgba(255,255,255,.06);
    display:flex;
    align-items:center;
    justify-content:center;
    color: rgba(255,255,255,.35);
    font-weight:900;
    letter-spacing:.08em;
    position:relative;
  }
  .imgBox img{
    width:100%;
    height:100%;
    object-fit:contain;
    display:block;
    background: rgba(0,0,0,.55);
  }

  /* combos un poco mÃ¡s bajos */
  .card[data-tab="combos"] .imgBox{ height: 200px; }

  /* Hint "tocar para agrandar" arriba-izquierda */
  .tapHint{
    position:absolute;
    top:10px; left:10px;
    font-size:12px;
    font-weight:950;
    letter-spacing:.2px;
    padding:7px 10px;
    border-radius:999px;
    color:#fff;
    background: rgba(0,0,0,.55);
    border:1px solid rgba(255,255,255,.12);
    user-select:none;
    pointer-events:none;
  }

  .priceTag{
    position:absolute;
    top:12px; right:12px;
    background: rgba(0,0,0,.60);
    border:1px solid rgba(255,255,255,.12);
    padding:7px 12px;
    border-radius:999px;
    font-weight:1000;
    letter-spacing:.3px;
  }

  .body{ padding: 12px 14px 14px; }
  .name{margin:0; font-size:18px; font-weight:1000; line-height:1.15;}
  .meta{margin-top:6px; font-size:13px; color:var(--muted); line-height:1.25;}
  .meta b{color: rgba(255,255,255,.92); font-weight:950;}
  .list{
    margin:10px 0 0;
    padding-left: 18px;
    color: rgba(255,255,255,.78);
    font-size: 13px;
    line-height:1.35;
  }

  .bottomRow{
    margin-top:12px;
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:10px;
    padding-top: 12px;
    border-top: 1px solid rgba(255,255,255,.08);
  }

  .qty{
    display:flex; align-items:center; gap:10px;
    font-size:13px;
    color: var(--muted);
    font-weight:900;
  }
  .qtyPill{
    padding:7px 11px;
    border-radius:999px;
    border:1px solid rgba(202,167,106,.28);
    background: rgba(202,167,106,.10);
    color:#fff;
    min-width:52px;
    text-align:center;
    font-weight:1000;
  }

  .btns{display:flex; gap:10px;}
  .btn{
    border:none;
    cursor:pointer;
    user-select:none;
    font-weight:1000;
    padding:12px 14px;
    border-radius: 14px;
    background: rgba(255,255,255,.06);
    border:1px solid rgba(255,255,255,.12);
    color:#fff;
    transition: transform .08s ease, filter .15s ease, background .15s ease, box-shadow .15s ease;
    -webkit-tap-highlight-color: transparent;
    box-shadow:
      0 10px 22px rgba(0,0,0,.28),
      inset 0 1px 0 rgba(255,255,255,.08);
  }
  .btn.is-pressed,
  .btn:active{
    transform: translateY(3px) scale(.965);
    filter: brightness(.90);
    box-shadow:
      inset 0 3px 14px rgba(0,0,0,.55),
      0 3px 10px rgba(0,0,0,.20);
  }
  .btn.add{
    background: linear-gradient(180deg, rgba(202,167,106,.95), rgba(143,111,63,.95));
    border:1px solid rgba(202,167,106,.55);
    color:#1a140b;
    box-shadow:
      0 12px 26px rgba(202,167,106,.18),
      0 10px 22px rgba(0,0,0,.28),
      inset 0 1px 0 rgba(255,255,255,.20);
  }
  .btn.minus{ background: rgba(255,255,255,.04); }

  /* Footer fijo */
  .footer{
    position:fixed; left:0; right:0; bottom:0;
    z-index:1000;
    background: rgba(10,10,12,.88);
    backdrop-filter: blur(12px);
    border-top:1px solid rgba(255,255,255,.10);
    padding:10px 12px;
  }
  .footerInner{
    max-width:720px;
    margin:0 auto;
    display:flex;
    gap:10px;
    align-items:center;
    justify-content:space-between;
    flex-wrap:wrap;
  }

  .totals{
    display:flex;
    flex-direction:column;
    gap:4px;
    padding:10px 12px;
    border-radius: 16px;
    background: rgba(255,255,255,.04);
    border:1px solid rgba(255,255,255,.10);
    width: 100%;
  }
  .totals .big{font-weight:1000; font-size:16px;}
  .totals .small{color:var(--muted); font-weight:900; font-size:13px;}
  .totals .extrasLine{
    margin-top:2px;
    font-size:13px;
    font-weight:900;
    color: rgba(255,255,255,.80);
  }
  .totals .extrasLine b{ color: var(--gold); }

  .footerBtns{
    width:100%;
    display:flex;
    gap:10px;
    align-items:center;
  }
  .btnGhost{
    flex:0 0 auto;
    padding:12px 14px;
    border-radius: 14px;
    background: rgba(255,255,255,.04);
    border:1px solid rgba(255,255,255,.10);
    color:#fff;
    font-weight:1000;
    cursor:pointer;
    transition: transform .08s ease, filter .15s ease, box-shadow .15s ease;
    -webkit-tap-highlight-color: transparent;
    box-shadow:
      0 10px 22px rgba(0,0,0,.28),
      inset 0 1px 0 rgba(255,255,255,.08);
  }
  .btnGhost.is-pressed,
  .btnGhost:active{
    transform: translateY(3px) scale(.965);
    filter:brightness(.90);
    box-shadow:
      inset 0 3px 14px rgba(0,0,0,.55),
      0 3px 10px rgba(0,0,0,.20);
  }
  .btnWA{
    flex:1;
    padding:12px 16px;
    border-radius: 14px;
    background: linear-gradient(180deg, rgba(202,167,106,.95), rgba(143,111,63,.95));
    border:1px solid rgba(202,167,106,.55);
    color:#1a140b;
    font-weight:1100;
    cursor:pointer;
    text-align:center;
    transition: transform .08s ease, filter .15s ease, box-shadow .15s ease;
    -webkit-tap-highlight-color: transparent;
    box-shadow:
      0 12px 26px rgba(202,167,106,.18),
      0 10px 22px rgba(0,0,0,.28),
      inset 0 1px 0 rgba(255,255,255,.20);
  }
  .btnWA.is-pressed,
  .btnWA:active{
    transform: translateY(3px) scale(.965);
    filter:brightness(.90);
    box-shadow:
      inset 0 3px 14px rgba(0,0,0,.45),
      0 3px 10px rgba(0,0,0,.20);
  }

  /* ===== Modal base ===== */
  .modal{
    position:fixed;
    inset:0;
    z-index:2000;
    background: rgba(0,0,0,.72);
    display:none;
    align-items:center;
    justify-content:center;
    padding: 16px;
  }
  .modal.show{display:flex;}
  .modalCard{
    width:100%;
    max-width:720px;
    background: rgba(15,16,18,.96);
    border:1px solid rgba(255,255,255,.10);
    border-radius: 18px;
    box-shadow: 0 28px 90px rgba(0,0,0,.65);
    overflow:hidden;
  }
  .modalTop{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:10px;
    padding:12px 12px;
    border-bottom:1px solid rgba(255,255,255,.10);
  }
  .modalTop .ttl{
    font-weight:950;
    letter-spacing:.2px;
    font-size:14px;
    color:#fff;
  }
  .closeBtn{
    width:40px; height:40px;
    border-radius: 12px;
    border:1px solid rgba(255,255,255,.12);
    background: rgba(255,255,255,.06);
    color:#fff;
    cursor:pointer;
    font-size:18px;
    font-weight:950;
    -webkit-tap-highlight-color: transparent;
    box-shadow:
      0 10px 22px rgba(0,0,0,.28),
      inset 0 1px 0 rgba(255,255,255,.08);
  }
  .closeBtn:active{
    transform: translateY(3px) scale(.965);
    filter:brightness(.90);
    box-shadow:
      inset 0 3px 14px rgba(0,0,0,.55),
      0 3px 10px rgba(0,0,0,.20);
  }

  /* modal imagen */
  .modalBodyImg{ padding: 0; background: rgba(0,0,0,.55); }
  .modalBodyImg img{
    width:100%;
    max-height: 78vh;
    object-fit: contain;
    display:block;
    background: rgba(0,0,0,.55);
  }

  /* modal salsas / modal pedido */
  .modalBody{ padding: 14px 14px 12px; }
  .helper{
    color: rgba(255,255,255,.78);
    font-size:13px;
    font-weight:850;
    margin: 0 0 10px;
  }
  .chips{ display:flex; flex-direction:column; gap:10px; }
  .chip{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:10px;
    padding:12px 12px;
    border-radius: 16px;
    border:1px solid rgba(255,255,255,.10);
    background: rgba(255,255,255,.04);
    cursor:pointer;
    user-select:none;
  }
  .chip .left{ display:flex; flex-direction:column; gap:3px; }
  .chip .nm{ font-weight:950; font-size:14px; }
  .chip .pr{ font-size:12.5px; color: rgba(255,255,255,.70); font-weight:850; }
  .chip input{ width:20px; height:20px; accent-color: var(--gold); }

  .modalBottom{
    padding: 12px 14px 14px;
    border-top:1px solid rgba(255,255,255,.10);
    display:flex;
    gap:10px;
  }
  .btnModal{
    flex:1;
    padding:12px 14px;
    border-radius: 14px;
    font-weight:1100;
    cursor:pointer;
    border:1px solid rgba(255,255,255,.12);
    background: rgba(255,255,255,.06);
    color:#fff;
    -webkit-tap-highlight-color: transparent;
    box-shadow:
      0 10px 22px rgba(0,0,0,.28),
      inset 0 1px 0 rgba(255,255,255,.08);
  }
  .btnModal:active{
    transform: translateY(3px) scale(.965);
    filter:brightness(.90);
    box-shadow:
      inset 0 3px 14px rgba(0,0,0,.55),
      0 3px 10px rgba(0,0,0,.20);
  }
  .btnModal.primary{
    background: linear-gradient(180deg, rgba(202,167,106,.95), rgba(143,111,63,.95));
    border:1px solid rgba(202,167,106,.55);
    color:#1a140b;
    box-shadow:
      0 12px 26px rgba(202,167,106,.18),
      0 10px 22px rgba(0,0,0,.28),
      inset 0 1px 0 rgba(255,255,255,.20);
  }

  /* Resumen pedido */
  .summaryBlock{
    border:1px solid rgba(255,255,255,.10);
    background: rgba(255,255,255,.03);
    border-radius: 16px;
    padding:12px 12px;
    margin-bottom:10px;
  }
  .summaryTitle{
    font-weight:950;
    color:#fff;
    margin:0 0 8px;
    letter-spacing:.2px;
  }
  .summaryLine{
    display:flex;
    justify-content:space-between;
    gap:10px;
    padding:6px 0;
    border-bottom: 1px dashed rgba(255,255,255,.10);
    font-size:13px;
    color: rgba(255,255,255,.82);
  }
  .summaryLine:last-child{border-bottom:none}
  .summaryLine .l{font-weight:850}
  .summaryLine .r{font-weight:950; color:#fff; white-space:nowrap}
  .miniMuted{color: rgba(255,255,255,.65); font-weight:800}
</style>
</head>

<body>
<header>
  <div class="wrap">
    <div class="brandRow">
      <div class="logo">âœ¦</div>
      <div><h1>Sushi Stella Maris</h1></div>
    </div>

    <div class="tabs" id="tabs">
      <div class="tab active" onclick="setTab('combos', this)">Combos</div>
      <div class="tab" onclick="setTab('rolls', this)">Rolls</div>
      <div class="tab" onclick="setTab('especiales', this)">Especiales</div>
      <div class="tab" onclick="setTab('makis', this)">Makis</div>
      <div class="tab" onclick="setTab('nigiris', this)">Nigiris</div>
      <div class="tab" onclick="setTab('sashimis', this)">Sashimis</div>
      <div class="tab" onclick="setTab('extras', this)">Salsas y adicionales</div>
    </div>
  </div>
</header>

<div class="content" id="content"></div>

<div class="footer">
  <div class="footerInner">
    <div class="totals">
      <div class="big" id="totalMoney">Total: $0</div>
      <div class="small" id="totalPieces">Total de piezas: 0</div>
      <div class="extrasLine" id="extrasLine"><b>Salsas y adicionales:</b> 0</div>
    </div>
    <div class="footerBtns">
      <button class="btnGhost" id="btnClear">Vaciar</button>
      <button class="btnGhost" id="btnPreview">Ver pedido</button>
      <button class="btnWA" id="btnWA">Confirmar por WhatsApp</button>
    </div>
  </div>
</div>

<!-- Modal Imagen -->
<div class="modal" id="imgModal">
  <div class="modalCard">
    <div class="modalTop">
      <div class="ttl" id="imgModalTitle">Imagen</div>
      <button class="closeBtn" onclick="closeImgModal()">Ã—</button>
    </div>
    <div class="modalBodyImg">
      <img id="imgModalEl" src="" alt="Imagen" />
    </div>
  </div>
</div>

<!-- Modal ElecciÃ³n de Salsas para combos -->
<div class="modal" id="sauceModal">
  <div class="modalCard">
    <div class="modalTop">
      <div class="ttl" id="sauceModalTitle">ElegÃ­ tus salsas</div>
      <button class="closeBtn" onclick="closeSauceModal(true)">Ã—</button>
    </div>
    <div class="modalBody">
      <p class="helper" id="sauceHelper">ElegÃ­ 1 salsa.</p>
      <div class="chips" id="sauceList"></div>
    </div>
    <div class="modalBottom">
      <button class="btnModal" onclick="closeSauceModal(true)">Cancelar</button>
      <button class="btnModal primary" onclick="confirmSauces()">Confirmar</button>
    </div>
  </div>
</div>

<!-- Modal Ver pedido -->
<div class="modal" id="orderModal">
  <div class="modalCard">
    <div class="modalTop">
      <div class="ttl">Tu pedido</div>
      <button class="closeBtn" onclick="closeOrderModal()">Ã—</button>
    </div>
    <div class="modalBody" id="orderBody"></div>
    <div class="modalBottom">
      <button class="btnModal" onclick="closeOrderModal()">Cerrar</button>
      <button class="btnModal primary" onclick="sendWA()">Enviar por WhatsApp</button>
    </div>
  </div>
</div>

<script>
  const WA = "5491164194866";

  const fmtMoney = (n) => {
    const x = Math.round(Number(n)||0);
    return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
  };

  // ===== Config: pool de â€œsalsa a elecciÃ³nâ€ (sin cargo) =====
  // (Exactamente las 4 opciones que pediste)
  const CHOICE_SAUCES = [
    { id:"salsa_ba",      name:"Salsa Buenos Aires" },
    { id:"maracuya",      name:"Salsa maracuyÃ¡" },
    { id:"mostaza_miel",  name:"Salsa mostaza y miel" },
    { id:"soja",          name:"Salsa de soja" }
  ];

  let activeTab = "combos";
  const cart = {}; // id -> qty (items con precio / piezas)
  // elecciones de salsas por combo (sin cargo)
  // saucePicks[comboId] = [ [salsaId, salsaId], [salsaId] ... ]  (una entrada por cada combo agregado)
  const saucePicks = {};

  // ===== MenÃº =====
  // NOTA: las imÃ¡genes (PNG) van en la raÃ­z del repo (mismo nivel que index.html)
  const MENU = [
    // ===== Combos =====
    {
      id:"combo10", tab:"combos",
      name:"Combo 10 piezas",
      pieces:10,
      price:16000,
      includesRule:"Incluye 1 salsa de soja fija",
      composition:["(ComposiciÃ³n a completar)"],
      img:"",
      chooseSauces: 0,
      includeSoja: 1
    },
    {
      id:"combo15", tab:"combos",
      name:"Combo 15 piezas",
      pieces:15,
      price:22000,
      includesRule:"Incluye 1 salsa de soja fija",
      composition:["(ComposiciÃ³n a completar)"],
      img:"",
      chooseSauces: 0,
      includeSoja: 1
    },
    {
      id:"combo20", tab:"combos",
      name:"Combo 20 piezas",
      pieces:20,
      price:30000,
      includesRule:"Incluye 1 salsa de soja fija",
      composition:["(ComposiciÃ³n a completar)"],
      img:"",
      chooseSauces: 0,
      includeSoja: 1
    },
    {
      id:"combo30", tab:"combos",
      name:"Combo 30 piezas",
      pieces:30,
      price:45000,
      includesRule:"Incluye 1 salsa de soja fija + 1 salsa a elecciÃ³n",
      composition:["(ComposiciÃ³n a completar)"],
      img:"",
      chooseSauces: 1,
      includeSoja: 1
    },
    {
      id:"combo40", tab:"combos",
      name:"Combo 40 piezas",
      pieces:40,
      price:55000,
      includesRule:"Incluye 2 salsas de soja fijas + 1 salsa a elecciÃ³n",
      composition:["(ComposiciÃ³n a completar)"],
      img:"",
      chooseSauces: 1,
      includeSoja: 2
    },
    {
      id:"combo50", tab:"combos",
      name:"Combo 50 piezas",
      pieces:50,
      price:70000,
      includesRule:"Incluye 2 salsas de soja fijas + 2 salsas a elecciÃ³n",
      composition:["(ComposiciÃ³n a completar)"],
      img:"",
      chooseSauces: 2,
      includeSoja: 2
    },

    // ===== Rolls (x5) =====
    { id:"avocado", tab:"rolls", name:"Avocado", pieces:5, price:0, desc:"(Completar descripciÃ³n).", img:"AVOCADO.PNG" },
    { id:"philadelphia", tab:"rolls", name:"Philadelphia", pieces:5, price:9000, desc:"SalmÃ³n fresco + queso crema.", img:"PHILADELPHIA.PNG" },
    { id:"newyork", tab:"rolls", name:"New York", pieces:5, price:0, desc:"SalmÃ³n y palta.", img:"NEW-YORK.PNG" },
    { id:"california", tab:"rolls", name:"California", pieces:5, price:0, desc:"Kani kama y palta.", img:"CALIFORNIA.PNG" },
    { id:"alaska", tab:"rolls", name:"Alaska", pieces:5, price:0, desc:"SalmÃ³n, palta y queso.", img:"ALASKA.PNG" },
    { id:"alaska_ahumado", tab:"rolls", name:"Alaska ahumado", pieces:5, price:0, desc:"SalmÃ³n ahumado, palta y queso.", img:"ALASKA-AHUMADO.PNG" },
    { id:"cheese_langostino", tab:"rolls", name:"Cheese langostino", pieces:5, price:0, desc:"Langostino y queso crema.", img:"CHEESE-LANGOSTINO.PNG" },
    { id:"buenos_aires_roll", tab:"rolls", name:"Buenos Aires", pieces:5, price:0, desc:"Langostinos, palta y queso cubierto con salsa Bs As.", img:"BUENOS-AIRES.PNG" },
    { id:"vegetariano", tab:"rolls", name:"Vegetariano", pieces:5, price:0, desc:"Zanahoria, palta y queso.", img:"VEGETARIANO.PNG" },

    // ===== Especiales (x5) =====
    { id:"rocoto", tab:"especiales", name:"Rocoto", pieces:5, price:0, desc:"SalmÃ³n y queso, levemente picante.", img:"ROCOTO.PNG" },
    { id:"tamago_roll", tab:"especiales", name:"Tamago", pieces:5, price:0, desc:"Huevo dulce japonÃ©s con salmÃ³n y queso.", img:"TAMAGO.PNG" },
    { id:"salmon_crispy", tab:"especiales", name:"SalmÃ³n crispy", pieces:5, price:0, desc:"SalmÃ³n y palta con topping de batata.", img:"SALMON-CRISPY.PNG" },
    { id:"ebi_langostino", tab:"especiales", name:"Ebi langostino", pieces:5, price:0, desc:"Langostino rebozado cubierto por salsa Bs As.", img:"EBI-LANGOSTINO.PNG" },
    { id:"paradise", tab:"especiales", name:"Paradise", pieces:5, price:0, desc:"Queso cubierto con salmÃ³n y topping de batata.", img:"PARADISE.PNG" },
    { id:"guacamole_roll", tab:"especiales", name:"Guacamole", pieces:5, price:10500, desc:"SalmÃ³n y queso con topping de guacamole.", img:"GUACAMOLE.PNG" },
    { id:"japan_flowers", tab:"especiales", name:"Japan Flowers", pieces:5, price:0, desc:"Queso y palta cubierto con salmÃ³n.", img:"JAPAN-FLOWERS.PNG" },
    { id:"crazy", tab:"especiales", name:"Crazy", pieces:5, price:0, desc:"Palta y queso envuelto en salmÃ³n.", img:"CRAZY.PNG" },

    // ===== Makis (x5) =====
    { id:"maki_salmon", tab:"makis", name:"Maki de salmÃ³n", pieces:5, price:0, desc:"SalmÃ³n.", img:"MAKI-DE-SALMON.PNG" },
    { id:"maki_atun", tab:"makis", name:"Maki de atÃºn", pieces:5, price:0, desc:"AtÃºn.", img:"MAKI-DE-ATUN.PNG" },
    { id:"maki_salmon_ah", tab:"makis", name:"Maki de salmÃ³n ahumado", pieces:5, price:0, desc:"SalmÃ³n ahumado.", img:"MAKI-DE-SALMON-AHUMADO.PNG" },
    { id:"maki_veggie", tab:"makis", name:"Maki veggie", pieces:5, price:0, desc:"Vegetales.", img:"MAKI-VEGGIE.PNG" },

    // ===== Nigiris (x5) =====
    { id:"niguiri_salmon", tab:"nigiris", name:"Nigiri de salmÃ³n", pieces:5, price:0, desc:"Arroz + salmÃ³n.", img:"NIGUIRI-DE-SALMON.PNG" },
    { id:"niguiri_salmon_ah", tab:"nigiris", name:"Nigiri de salmÃ³n ahumado", pieces:5, price:0, desc:"Arroz + salmÃ³n ahumado.", img:"NIGUIRI-DE-SALMON-AHUMADO.PNG" },
    { id:"keki", tab:"nigiris", name:"Keki", pieces:5, price:0, desc:"(Completar descripciÃ³n).", img:"KEKI.PNG" },

    // ===== Sashimis (x5) =====
    { id:"sashimi_salmon", tab:"sashimis", name:"Sashimi de salmÃ³n", pieces:5, price:0, desc:"Cortes de salmÃ³n.", img:"SASHIMI-DE-SALMON.PNG" },
    { id:"sashimi_flameado", tab:"sashimis", name:"Sashimi de salmÃ³n flameado", pieces:5, price:0, desc:"Cortes flameados.", img:"SASHIMI-DE-SALMON-FLAMEADO.PNG" },

    // ===== Salsas & adicionales (unidad) =====
    // OJO: estas son â€œadicionalesâ€ (con precio). Las de â€œa elecciÃ³nâ€ en combos van SIN CARGO y se manejan aparte.
    { id:"soja", tab:"extras", name:"Salsa de soja", pieces:0, price:850, desc:"Unidad.", img:"SALSA-DE-SOJA.PNG" },
    { id:"salsa_ba", tab:"extras", name:"Salsa Buenos Aires", pieces:0, price:1300, desc:"Unidad.", img:"SALSA-BUENOS-AIRES.PNG" },
    { id:"mostaza_miel", tab:"extras", name:"Salsa mostaza y miel", pieces:0, price:1300, desc:"Unidad.", img:"SALSA-DE-MOSTAZA-Y-MIEL.PNG" },
    { id:"maracuya", tab:"extras", name:"Salsa maracuyÃ¡", pieces:0, price:1500, desc:"Unidad.", img:"SALSA-DE-MARACUYA.PNG" },
    { id:"guacamole_extra", tab:"extras", name:"Salsa guacamole", pieces:0, price:850, desc:"Unidad.", img:"SALSA-GUACAMOLE.PNG" },

    { id:"criolla", tab:"extras", name:"Criolla", pieces:0, price:750, desc:"Unidad.", img:"CRIOLLA.PNG" },
    { id:"jengibre", tab:"extras", name:"Jengibre", pieces:0, price:750, desc:"Unidad.", img:"JENGIBRE.PNG" },
    { id:"pepino", tab:"extras", name:"Pepino", pieces:0, price:700, desc:"Unidad.", img:"PEPINO.PNG" }
  ];

  const getQty = (id) => cart[id] || 0;

  function haptic() {
    try { if (navigator.vibrate) navigator.vibrate(12); } catch(e){}
  }

  // ===== Botones â€œse nota presionadoâ€ (tambiÃ©n en iPhone) =====
  function bindPressFeedback(){
    const pressables = document.querySelectorAll("button, .tab, .chip");
    pressables.forEach(el=>{
      el.addEventListener("pointerdown", ()=> el.classList.add("is-pressed"));
      const off = ()=> el.classList.remove("is-pressed");
      el.addEventListener("pointerup", off);
      el.addEventListener("pointercancel", off);
      el.addEventListener("pointerleave", off);
    });
  }

  function setTab(tab, el){
    activeTab = tab;
    document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
    el.classList.add("active");
    render();
    window.scrollTo({top:0, behavior:"smooth"});
  }

  // ===== Modal imagen =====
  function openImgModal(name, src){
    if (!src) return;
    document.getElementById("imgModalTitle").textContent = name || "Imagen";
    document.getElementById("imgModalEl").src = src;
    document.getElementById("imgModal").classList.add("show");
  }
  function closeImgModal(){
    document.getElementById("imgModal").classList.remove("show");
    document.getElementById("imgModalEl").src = "";
  }
  document.getElementById("imgModal").addEventListener("click", (e)=>{
    if (e.target.id === "imgModal") closeImgModal();
  });

  // ===== Modal elecciÃ³n salsas combos =====
  let pendingSaucePick = null; // {comboId, count}

  function openSauceModal(comboItem){
    const count = Number(comboItem.chooseSauces||0);
    if (!count) return;

    pendingSaucePick = { comboId: comboItem.id, count };

    document.getElementById("sauceModalTitle").textContent =
      count === 1 ? "ElegÃ­ 1 salsa" : `ElegÃ­ ${count} salsas`;

    document.getElementById("sauceHelper").textContent =
      count === 1 ? "ElegÃ­ 1 salsa (sin cargo)." : `ElegÃ­ ${count} salsas (sin cargo).`;

    const list = document.getElementById("sauceList");
    list.innerHTML = CHOICE_SAUCES.map(s=>{
      return `
        <label class="chip">
          <div class="left">
            <div class="nm">${s.name}</div>
            <div class="pr">Sin cargo</div>
          </div>
          <input type="checkbox" value="${s.id}" />
        </label>
      `;
    }).join("");

    list.querySelectorAll("input").forEach(inp=>{
      inp.addEventListener("change", ()=>{
        const checked = [...list.querySelectorAll("input:checked")];
        if (checked.length > pendingSaucePick.count){
          inp.checked = false;
        }
      });
    });

    document.getElementById("sauceModal").classList.add("show");
    bindPressFeedback();
  }

  function closeSauceModal(isCancel){
    document.getElementById("sauceModal").classList.remove("show");

    // Si cancela: dejamos el combo agregado pero sin registrar elecciÃ³n.
    // (Puede volver a tocar Agregar y elegir bien; o lo ajustamos despuÃ©s si querÃ©s).
    pendingSaucePick = null;

    if (isCancel){
      // nada
    }
  }

  document.getElementById("sauceModal").addEventListener("click", (e)=>{
    if (e.target.id === "sauceModal") closeSauceModal(true);
  });

  function confirmSauces(){
    if (!pendingSaucePick) return;

    const list = document.getElementById("sauceList");
    const ids = [...list.querySelectorAll("input:checked")].map(x=>x.value);

    if (ids.length !== pendingSaucePick.count){
      alert(`ElegÃ­ ${pendingSaucePick.count} salsa${pendingSaucePick.count>1?'s':''}.`);
      return;
    }

    // Guardar elecciÃ³n (sin cargo) como una instancia mÃ¡s del combo
    if (!saucePicks[pendingSaucePick.comboId]) saucePicks[pendingSaucePick.comboId] = [];
    saucePicks[pendingSaucePick.comboId].push(ids);

    haptic();
    updateTotals();
    updateQtyPills();
    closeSauceModal(false);
  }

  // ===== Carrito =====
  function add(id){
    cart[id] = (cart[id]||0) + 1;
    haptic();
    updateTotals();
    updateQtyPills();

    const item = MENU.find(x=>x.id===id);
    if (item && item.tab==="combos" && Number(item.chooseSauces||0) > 0){
      openSauceModal(item);
    }
  }

  function sub(id){
    if (!cart[id]) return;

    const item = MENU.find(x=>x.id===id);

    // si es combo: al restar, tambiÃ©n borramos la Ãºltima elecciÃ³n guardada (si existe)
    if (item && item.tab==="combos" && Number(item.chooseSauces||0) > 0){
      if (saucePicks[id] && saucePicks[id].length){
        saucePicks[id].pop();
        if (saucePicks[id].length === 0) delete saucePicks[id];
      }
    }

    cart[id] -= 1;
    if (cart[id] <= 0) delete cart[id];

    haptic();
    updateTotals();
    updateQtyPills();
  }

  function clearCart(){
    if (Object.keys(cart).length === 0) return;
    if (!confirm("Â¿Vaciar el pedido?")) return;
    for (const k of Object.keys(cart)) delete cart[k];
    for (const k of Object.keys(saucePicks)) delete saucePicks[k];
    updateTotals();
    render();
  }

  function totals(){
    let totalMoney = 0;
    let totalPieces = 0;

    for (const [id, qty] of Object.entries(cart)){
      const item = MENU.find(x => x.id === id);
      if (!item) continue;
      totalMoney += (item.price||0) * qty;
      totalPieces += (item.pieces||0) * qty;
    }
    return { totalMoney, totalPieces };
  }

  // ===== Salsas (incluidas + elecciÃ³n + adicionales) =====
  function includedSojaCount(){
    let n = 0;
    for (const [id, qty] of Object.entries(cart)){
      const item = MENU.find(x=>x.id===id);
      if (!item || item.tab !== "combos") continue;
      n += (Number(item.includeSoja||0) * qty);
    }
    return n;
  }

  function choiceSaucesCounts(){
    const counts = {};
    for (const [comboId, picks] of Object.entries(saucePicks)){
      // picks: array de arrays
      picks.forEach(arr=>{
        arr.forEach(sauceId=>{
          counts[sauceId] = (counts[sauceId]||0) + 1;
        });
      });
    }
    return counts; // { salsa_ba:2, soja:1 ... }
  }

  function additionalExtrasCounts(){
    // todo lo que estÃ¡ en tab extras y estÃ¡ en cart => adicional (con precio)
    const counts = {};
    for (const [id, qty] of Object.entries(cart)){
      const item = MENU.find(x=>x.id===id);
      if (!item) continue;
      if (item.tab === "extras" && item.pieces === 0){
        counts[id] = (counts[id]||0) + qty;
      }
    }
    return counts;
  }

  function totalSaucesAndExtrasCount(){
    const inc = includedSojaCount();
    const choice = Object.values(choiceSaucesCounts()).reduce((a,b)=>a+b,0);
    const addi = Object.values(additionalExtrasCounts()).reduce((a,b)=>a+b,0);
    return inc + choice + addi;
  }

  function updateTotals(){
    const { totalMoney, totalPieces } = totals();
    document.getElementById("totalMoney").textContent = `Total: $${fmtMoney(totalMoney)}`;
    document.getElementById("totalPieces").textContent = `Total de piezas: ${totalPieces}`;
    document.getElementById("extrasLine").innerHTML = `<b>Salsas y adicionales:</b> ${totalSaucesAndExtrasCount()}`;
  }

  function updateQtyPills(){
    MENU.forEach(item => {
      const pill = document.getElementById("qty-"+item.id);
      if (!pill) return;
      pill.textContent = (getQty(item.id)) + "x";
    });
  }

  // ===== WhatsApp (con separaciÃ³n incluida / elecciÃ³n / adicional) =====
  function buildMessage(){
    const sushiLines = [];
    const comboLines = [];
    const additionalLines = [];

    // ordenar items no-extras para mensaje prolijo
    const entries = Object.entries(cart)
      .map(([id, qty]) => ({ qty, item: MENU.find(x => x.id === id) }))
      .filter(x => x.item)
      .sort((a,b) => (a.item.tab + a.item.name).localeCompare(b.item.tab + b.item.name));

    let totalMoney = 0;
    let totalPieces = 0;

    for (const {qty, item} of entries){
      totalMoney += (item.price||0) * qty;
      totalPieces += (item.pieces||0) * qty;

      const linePieces = (item.pieces||0) * qty;
      const linePrice  = (item.price||0) * qty;

      if (item.tab === "extras" && item.pieces === 0){
        // adicional con precio
        additionalLines.push(`${qty}x ${item.name} â€” $${fmtMoney(linePrice)}`);
        continue;
      }

      if (item.tab === "combos"){
        comboLines.push(`${qty}x ${item.name} â€“ ${linePieces} piezas â€” $${fmtMoney(linePrice)}`);
      } else {
        // sushi x5
        const xBase = item.pieces === 5 ? " x5" : "";
        sushiLines.push(`${qty}x ${item.name}${xBase} â€“ ${linePieces} piezas â€” $${fmtMoney(linePrice)}`);
      }
    }

    // salsas incluidas (soja fija)
    const incSoja = includedSojaCount();

    // salsas a elecciÃ³n (sin cargo)
    const choiceCounts = choiceSaucesCounts();
    const choiceLines = [];
    Object.entries(choiceCounts)
      .sort((a,b)=>{
        const na = (CHOICE_SAUCES.find(x=>x.id===a[0])||{}).name || a[0];
        const nb = (CHOICE_SAUCES.find(x=>x.id===b[0])||{}).name || b[0];
        return na.localeCompare(nb);
      })
      .forEach(([id, qty])=>{
        const nm = (CHOICE_SAUCES.find(x=>x.id===id)||{}).name || id;
        choiceLines.push(`${nm} x${qty}`);
      });

    // adicionales (con precio) ya estÃ¡n en additionalLines
    let msg = "";
    msg += "Hola Stella Maris Sushi ðŸ£\n\n";
    msg += "Quiero pedir:\n\n";

    msg += "ðŸ£ Sushi:\n";
    if (comboLines.length) msg += comboLines.join("\n") + "\n";
    msg += (sushiLines.length ? sushiLines.join("\n") : "â€”") + "\n\n";

    msg += "ðŸ¥£ Salsas:\n";
    msg += `Salsa incluida (sin cargo): Salsa de soja x${incSoja}\n`;
    msg += `Salsa a elecciÃ³n (sin cargo): ${choiceLines.length ? choiceLines.join(" â€¢ ") : "â€”"}\n`;
    msg += "Salsa adicional:\n";
    msg += (additionalLines.length ? additionalLines.join("\n") : "â€”") + "\n\n";

    msg += `Total de piezas: ${totalPieces}\n`;
    msg += `Total salsas y adicionales: ${totalSaucesAndExtrasCount()}\n`;
    msg += `Total: $${fmtMoney(totalMoney)}\n\n`;
    msg += "Retiro en el local.";

    return msg;
  }

  function sendWA(){
    if (Object.keys(cart).length === 0){
      alert("AgregÃ¡ algo al pedido ðŸ™‚");
      return;
    }
    const msg = buildMessage();
    const url = `https://wa.me/${WA}?text=${encodeURIComponent(msg)}`;
    window.open(url, "_blank");
  }

  // ===== Ver pedido (modal) =====
  function openOrderModal(){
    if (Object.keys(cart).length === 0){
      alert("TodavÃ­a no agregaste nada ðŸ™‚");
      return;
    }

    const { totalMoney, totalPieces } = totals();
    const totalSauces = totalSaucesAndExtrasCount();

    // Armado resumen
    const sushi = [];
    const combos = [];
    const adicionales = [];

    const entries = Object.entries(cart)
      .map(([id, qty]) => ({ qty, item: MENU.find(x => x.id === id) }))
      .filter(x => x.item)
      .sort((a,b) => (a.item.tab + a.item.name).localeCompare(b.item.tab + b.item.name));

    entries.forEach(({qty, item})=>{
      const linePieces = (item.pieces||0) * qty;
      const linePrice  = (item.price||0) * qty;

      if (item.tab === "extras" && item.pieces === 0){
        adicionales.push({left:`${qty}x ${item.name}`, right:`$${fmtMoney(linePrice)}`});
        return;
      }

      if (item.tab === "combos"){
        combos.push({left:`${qty}x ${item.name} (${linePieces} piezas)`, right:`$${fmtMoney(linePrice)}`});
      } else {
        const xBase = item.pieces === 5 ? " x5" : "";
        sushi.push({left:`${qty}x ${item.name}${xBase} (${linePieces} piezas)`, right:`$${fmtMoney(linePrice)}`});
      }
    });

    const incSoja = includedSojaCount();
    const choiceCounts = choiceSaucesCounts();
    const choiceTotal = Object.values(choiceCounts).reduce((a,b)=>a+b,0);

    const body = document.getElementById("orderBody");
    body.innerHTML = `
      <div class="summaryBlock">
        <p class="summaryTitle">Resumen</p>
        <div class="summaryLine"><span class="l">Total</span><span class="r">$${fmtMoney(totalMoney)}</span></div>
        <div class="summaryLine"><span class="l">Total de piezas</span><span class="r">${totalPieces}</span></div>
        <div class="summaryLine"><span class="l">Salsas y adicionales</span><span class="r">${totalSauces}</span></div>
      </div>

      ${combos.length ? `
        <div class="summaryBlock">
          <p class="summaryTitle">Combos</p>
          ${combos.map(x=>`<div class="summaryLine"><span class="l">${escapeHtml(x.left)}</span><span class="r">${escapeHtml(x.right)}</span></div>`).join("")}
        </div>
      ` : ""}

      ${sushi.length ? `
        <div class="summaryBlock">
          <p class="summaryTitle">Sushi</p>
          ${sushi.map(x=>`<div class="summaryLine"><span class="l">${escapeHtml(x.left)}</span><span class="r">${escapeHtml(x.right)}</span></div>`).join("")}
        </div>
      ` : ""}

      <div class="summaryBlock">
        <p class="summaryTitle">Salsas</p>
        <div class="summaryLine"><span class="l">Incluida (sin cargo)</span><span class="r">Soja x${incSoja}</span></div>
        <div class="summaryLine"><span class="l">A elecciÃ³n (sin cargo)</span><span class="r">${choiceTotal ? choiceTotal : "â€”"}</span></div>
        <div class="summaryLine"><span class="l">Adicional (con precio)</span><span class="r">${adicionales.length ? adicionales.reduce((a,_)=>a+1,0) : "â€”"}</span></div>
        <div class="miniMuted" style="margin-top:8px;">
          (El detalle completo se envÃ­a en el mensaje de WhatsApp)
        </div>
      </div>

      ${adicionales.length ? `
        <div class="summaryBlock">
          <p class="summaryTitle">Salsa adicional (detalle)</p>
          ${adicionales.map(x=>`<div class="summaryLine"><span class="l">${escapeHtml(x.left)}</span><span class="r">${escapeHtml(x.right)}</span></div>`).join("")}
        </div>
      ` : ""}
    `;

    document.getElementById("orderModal").classList.add("show");
    bindPressFeedback();
  }

  function closeOrderModal(){
    document.getElementById("orderModal").classList.remove("show");
  }
  document.getElementById("orderModal").addEventListener("click", (e)=>{
    if (e.target.id === "orderModal") closeOrderModal();
  });

  // ===== Cards =====
  function escapeQuotes(s){
    return String(s||"").replace(/'/g, "\\'").replace(/"/g, '&quot;');
  }
  function escapeHtml(s){
    return String(s||"")
      .replaceAll("&","&amp;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;")
      .replaceAll('"',"&quot;")
      .replaceAll("'","&#039;");
  }

  function cardHTML(item){
    const price = item.price ? `$${fmtMoney(item.price)}` : "â€”";
    const qty = getQty(item.id);

    const hasImg = !!item.img;
    const imgBlock = hasImg
      ? `<div class="imgBox" onclick="openImgModal('${escapeQuotes(item.name)}','${escapeQuotes(item.img)}')">
           <div class="tapHint">TocÃ¡ para agrandar</div>
           <img src="${item.img}" alt="${escapeQuotes(item.name)}">
         </div>`
      : `<div class="imgBox">Foto (pendiente)</div>`;

    const base = (item.pieces === 5) ? "x5 piezas" : (item.pieces > 0 ? `${item.pieces} piezas` : "Unidad");

    const desc = item.tab === "combos"
      ? `<div class="meta"><b>${base}</b> Â· ${item.includesRule || ""}</div>
         ${(item.composition && item.composition.length) ? `<ul class="list">${item.composition.map(x=>`<li>${x}</li>`).join("")}</ul>` : ""}`
      : `<div class="meta"><b>${base}</b> Â· ${item.desc || ""}</div>`;

    return `
      <div class="card" data-tab="${item.tab}">
        <div class="priceTag">${price}</div>
        ${imgBlock}
        <div class="body">
          <p class="name">${item.name}</p>
          ${desc}
          <div class="bottomRow">
            <div class="qty">En tu pedido: <span class="qtyPill" id="qty-${item.id}">${qty}x</span></div>
            <div class="btns">
              <button class="btn minus" onclick="sub('${item.id}')">â€“</button>
              <button class="btn add" onclick="add('${item.id}')">Agregar</button>
            </div>
          </div>
        </div>
      </div>
    `;
  }

  function tabTitle(tab){
    const map = {
      combos:"COMBOS",
      rolls:"ROLLS",
      especiales:"ESPECIALES",
      makis:"MAKIS",
      nigiris:"NIGIRIS",
      sashimis:"SASHIMIS",
      extras:"SALSAS Y ADICIONALES"
    };
    return map[tab] || tab.toUpperCase();
  }

  function render(){
    const root = document.getElementById("content");
    const items = MENU.filter(x => x.tab === activeTab);

    root.innerHTML = `
      <div class="sectionTitle">${tabTitle(activeTab)}</div>
      <div class="grid">
        ${items.map(cardHTML).join("")}
      </div>
    `;

    updateTotals();
    updateQtyPills();
    bindPressFeedback();
  }

  // ===== Events =====
  document.getElementById("btnClear").addEventListener("click", clearCart);
  document.getElementById("btnWA").addEventListener("click", sendWA);
  document.getElementById("btnPreview").addEventListener("click", openOrderModal);

  render();
</script>
</body>
</html>
